<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
	backgroundAlpha="1.0"
	currentState="{ model.currentPlayerState }"	
	rollOver="showControls();"
	rollOut="hideControls(); dragController.stopDrag(event.stageX, event.stageY);"
	mouseWheel="zoomController.changeZoomLevel(event.delta);"
	mouseDown="dragController.startDrag(event.stageX, event.stageY);"
	mouseMove="dragController.dragDisplay(event.stageX, event.stageY);"
	mouseUp="dragController.stopDrag(event.stageX, event.stageY);"
	xmlns:view="org.opencast.engage.brick.videodisplay.view.*">
	<mx:Script>
		<![CDATA[
			import mx.core.Application;
			import org.opencast.engage.brick.videodisplay.control.DragController;
			import org.opencast.engage.brick.videodisplay.control.ZoomController;
			import org.opencast.engage.brick.videodisplay.control.event.SetVolumeEvent;
			import org.opencast.engage.brick.videodisplay.state.PlayerState;
			import org.opencast.engage.brick.videodisplay.control.event.VideoControlEvent;
			import org.swizframework.Swiz;
			import org.opencast.engage.brick.videodisplay.model.VideodisplayModel;
			
			// size and position of buttons, ...
			[Bindable] 
			private var buttonSizeFactor        : int = 20;
			[Bindable] 
			private var buttonRightGapFactor    : int = 60;
			[Bindable] 
			private var buttonBottomGapFactor   : int = 75;
			
			[Autowire]
			[Bindable]
			public var model:VideodisplayModel;
			
			[Autowire(bean="zoomController")]
			public var zoomController: ZoomController;
			
			[Autowire(bean="dragController")]
			public var dragController: DragController;
		
			private function showControls(): void {
				
				controlBar.visible = true;
			
			}
			
			private function hideControls(): void {
			
				controlBar.visible = false;
			
			}
			
			private function playPauseClick(evt: MouseEvent): void {
				
				if (this.currentState == PlayerState.PLAYING) {
					playPauseButton.styleName = 'Play';
					Swiz.dispatchEvent( new VideoControlEvent(VideoControlEvent.PAUSE));
				} else {
					playPauseButton.styleName = 'Pause';
					Swiz.dispatchEvent( new VideoControlEvent(VideoControlEvent.PLAY));				
				} 
				showControls();
			
			}

		]]>
	</mx:Script>
	
	<mx:states>
		<mx:State name="{PlayerState.PLAYING}">
			<mx:SetProperty target="{ playPauseButton }"
				name="styleName"
				value="Pause"/>
		</mx:State>
		<mx:State name="{PlayerState.PAUSING}">
			<mx:SetProperty target="{ playPauseButton }"
				name="styleName"
				value="Play"/>
		</mx:State>
	</mx:states>
	
	<mx:transitions>
		<mx:Transition id="fadeOut"
			fromState="{PlayerState.PLAYING}"
			toState="{PlayerState.PAUSING}">
			<mx:Parallel target="{curtain}">
				<mx:Fade alphaFrom="0"
					alphaTo="1.0"
					duration="500"/>
			</mx:Parallel>
		</mx:Transition>
		<mx:Transition id="fadeIn"
			fromState="{PlayerState.PAUSING}"
			toState="{PlayerState.PLAYING}">
			<mx:Parallel target="{curtain}">
				<mx:Fade alphaFrom="1.0"
					alphaTo="0.0"
					duration="500"/>
			</mx:Parallel>
		</mx:Transition>
	</mx:transitions>
	
	<mx:Canvas id="curtain"
		backgroundColor="#000000"
		backgroundAlpha="0.5"
		width="100%"
		height="100%"
		x="0"
		y="0">
	</mx:Canvas>
	
	<mx:Canvas id="controlBar"
		width="100%"
		bottom="25"
		backgroundColor="#000000"
		backgroundAlpha="0.5" 
		borderColor="#000000"
		borderThickness="5">
		<mx:HBox right="25" 
			top="5"
			bottom="5">
		
			<mx:Button id="playPauseButton"
				click="playPauseClick(event);"
				width="{ this.width / buttonSizeFactor }"
				height="{ this.width / buttonSizeFactor }"
				styleName="Play"
				buttonMode="true" />
				
			<mx:Button id="defaultZoomButton"
				click="zoomController.setZoomLevel(100);"
				width="{ this.width / buttonSizeFactor }"
				height="{ this.width / buttonSizeFactor }"
				styleName="DefaultZoom"
				buttonMode="true" />
				
			<mx:Button id="zoomOutButton"
				click="zoomController.changeZoomLevel(-5);"
				width="{ this.width / buttonSizeFactor }"
				height="{ this.width / buttonSizeFactor }"
				styleName="ZoomOut"
				buttonMode="true" />
				
			<mx:Button id="zoomInButton"
				click="zoomController.changeZoomLevel(5);"
				width="{ this.width / buttonSizeFactor }"
				height="{ this.width / buttonSizeFactor }"
				styleName="ZoomIn"
				buttonMode="true" />
						
		</mx:HBox>
		
	</mx:Canvas>
		
	<!-- Overlay in the upper right corner
		which showes the current position -->
		
	<mx:Canvas id="positionDisplay"
		top="{ this.width / 50 }"
		right="{ this.width / 25 }"
		width="{ this.width / 5 }"
		height="{ this.height / 5 }"
		backgroundColor="#ffffff"
		backgroundAlpha="0.35"
		visible="false"
		styleName="PositionDisplay" >
		
		<!-- I don't like it ... but it works: -->
		<mx:Canvas id="innerPositionDisplay"
			width="{ positionDisplay.width * 100 / model.zoomLevel }"
			height="{ positionDisplay.height * 100 / model.zoomLevel }"
			left="{ positionDisplay.width * - model.displayPositionX / 
				(Application.application.width * model.zoomLevel / 100) }"
			top="{ positionDisplay.height * - model.displayPositionY / 
				(Application.application.height * model.zoomLevel / 100) }"
			backgroundAlpha="0.35"
			backgroundColor="#ffffff"
			visible="true"
			styleName="InnerPositionDisplay" />
		
	</mx:Canvas>
		
	<mx:NumberFormatter id="zoomNumFormat" />
	<mx:Label id="lblZoomLevel" 
		text="Zoom: {zoomNumFormat.format(model.zoomLevel)} %" 
		fontSize="{ this.width / 30 }"
		fontWeight="bold" 
		color="#FFFFFF"
		visible="false" />
</mx:Canvas>